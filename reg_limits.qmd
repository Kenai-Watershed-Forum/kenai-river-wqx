# Regulatory Limits

We calculated regulatory limits based on freshwater quality standards listed from state and federal regulatory agencies.




##Hardness

Some regulatory values are hardness-dependent, and hardness varies by site, by season, and with hydrologic conditions. We calculated hardness according to the following formula:

:::{.callout-note appearance = "simple}

Hardness = 2.497(Total Calcium in mg/L) + 4.119(Total Magnesium in mg/L)

:::

For sampling events with duplicate samples, we calculated average hardness.

```{r echo = F}
library(tidyverse)
library(readxl)
library(janitor)

# calculate hardness for all sample events in project history with available data

# source formatted data
dat <- read.csv("other/output/analysis_format/baseline_analysis_format.csv")

# calculate hardness column
hard <- dat %>%
  select(activity_identifier, activity_start_date, characteristic_name, result_measure_value) %>%
  filter(characteristic_name %in% (c("Magnesium","Calcium"))) %>%
  group_by(activity_identifier, activity_start_date, characteristic_name) %>%
  # get mean of duplicate samples
  summarise(avg_value = mean(result_measure_value)) %>%
  pivot_wider(names_from = "characteristic_name", values_from = "avg_value") %>%
  mutate(hardness = 2.497*(Calcium) + 4.119*(Magnesium)) %>%
  select(-Calcium, -Magnesium)

# join hardness back to overall dataset
dat <- left_join(dat,hard) 

# export hardness results
dir <- "other/output/hardness/dat_hardness.csv"
write.csv(dat, dir, row.names = F)

# make data downloadable
xfun::embed_file(dir, name = "Kenai River Baseline Hardness Data")

```

<br>

We calculated hardness-dependent criteria based on formulas published on the Alaska Department of Environmental Conservation's Water Quality Standards Section website. The "Alaska Water Quality Criteria Manual for Toxic and other Deleterious Organic and Inorganic Substances" (2022) document along with the "Inorganic Toxics Criteria Worksheet" provide parameter-specific formulas for many substances.

https://dec.alaska.gov/water/water-quality/standards/

Hardness-dependent criteria may be calculated from the following for freshwater metals:

Acute (dissolved) = exp {m A[ln(hardness)]+ bA} (CF)
Chronic (dissolved) = exp{m C [ln(hardness)] + bC} (CF)

```{r echo = F}

# hardness-dependent criteria
# see page 29 of "Alaska Water Quality Criteria Manual for Toxic and other Deleterious Organic and Inorganic Substances" for parameters and formulas

# read in parameters for hardness dependent criteria
diss_metals_hard_param <- read_excel("other/input/regulatory_limits/master_reg_limits.xlsx", skip = 1, sheet = "diss_metals_hard_parameters") %>%
  remove_empty() %>%
  select(-parameter_agency_name)

# join calculation parameters to overall dataset
z <- inner_join(dat, diss_metals_hard_param) %>%
  # calculate hardness dependent criteria values
  mutate(fw_acute_std = exp(m_a*(log(hardness)) + b_a)*fw_acute_convert)



# for hardness dependent conversion factors, maybe use a case_when for those two (Cd, Pb) specifically





# it appears that export from EPA WQX of 2000 - 2014 data does not include status of samples as DUP or Trip Blank. Are results included at all? Also note that from Summer 2022 - present we are also using field blanks

# 11/16/23 working here to set up formulas for calculated criteria, see spreadsheet other/input/regulatory_limits

# 1.) read in static reg values
# 2.) calculate acute values
# 3.) calculate chronic values
# 4.) calculate other condition-dependent values (e.g. temp)
  
```

